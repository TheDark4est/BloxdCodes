# 死神永生
> 服务器源代码 2025/11/15
>
> 包含字符串与方块转化(疑似没啥用)、防炸服、加入欢迎、指令系统、设置管理员等核心部分
>
> 为保护劳动，鼓励创新，请在转载时注明来源

```js
/*
    备注：如果你要拿走此代码，请修改owner和admins变量的内容。
    死神永生色系：
        #ac73ff #aca8ff #9de5ff #d5fdff #ff4d4d  #ff8364  #fdb87d  #ffe8d5 #d7fbe8 #9df3c4 #62d2a2  #1fab89
*/
api.broadcastMessage("这是测试信息:世界指令修改完毕");
const owner = 'The_DarkForest';
var admins = ['The_DarkForest', 'CN171_21', 'Silverpiston___', '__DUNE__', 'byto10','Cube_ICE_ohTshaco'];
const chars = [
    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
    'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
    'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
    '+', '-', '*', '/', '%', '=', '<', '>', '&', '|', '^', '~', '!', '"', '#', '$', '\'', '(', ')', ',', '.', ':', ';', '?', '@', '[', ']', '_', '`', '{', '}'
];
const items = [
    'White Ceramic', 'Red Ceramic', 'Orange Ceramic', 'Yellow Ceramic', 'Green Ceramic', 'Cyan Ceramic', 'Blue Ceramic', 'Purple Ceramic', 'Magenta Ceramic', 'Pink Ceramic',
    'Red Planks', 'Orange Planks', 'Yellow Planks', 'Lime Planks', 'Green Planks', 'Cyan Planks', 'Light Blue Planks', 'Blue Planks', 'Purple Planks', 'Magenta Planks', 'Pink Planks', 'White Planks', 'Gray Planks', 'Black Planks',
    'Red Wool', 'Orange Wool', 'Yellow Wool', 'Green Wool', 'Cyan Wool',
    'Light Blue Wool', 'Blue Wool', 'Purple Wool', 'Magenta Wool', 'White Wool', 'Gray Wool', 'Black Wool',
    'Red Glass', 'Orange Glass', 'Yellow Glass', 'Lime Glass', 'Green Glass', 'Cyan Glass', 'Light Blue Glass', 'Blue Glass', 'Purple Glass', 'Magenta Glass', 'Pink Glass', 'White Glass', 'Gray Glass', 'Black Glass',
    'Patterned Red Glass', 'Patterned Orange Glass', 'Patterned Yellow Glass', 'Patterned Green Glass', 'Patterned Cyan Glass', 'Patterned Light Blue Glass', 'Patterned Blue Glass', 'Patterned Purple Glass', 'Patterned Magenta Glass',
    'Patterned Light Gay Glass', 'Patterned Gray Glass', 'Patterned Black Glass',
    'Grass Block', 'Dirt', 'Sand', 'Red Sand', 'Clay', 'Block of Iron', 'Aspen Wood Planks', 'Maple Wood Planks', 'Diorite Bricks', 'Andesite Bricks', 'Stone Bricks', 'Granite Bricks', 'Magma',
    'Gold Decoration', 'Engraved Granite', 'Engraved Andesite', 'Red Sandstone', 'Aspen Leaves', 'Maple Leaves', 'Apple Block', 'Coconut Block', 'Red Mushroom Block', 'Brown Mushroom Block', 'Tilled Soil', 'Pumpkin', 'Pear Log', 'Maple Log', 'Glass', 'Barkness Aspen Log', 'Barkness Maple Log'
];
function convert(data) {
    const res = [];
    for (let i = 0; i < data.length; i++) {
        const char = data[i];
        const index = chars.indexOf(char);
        if (index === -1) continue;  // 跳过无效字符
        if (index >= items.length) continue;  // 防止越界
        res.push(items[index]);
    }
    return res;
}
function savedata(x, y, z, data) {
    while (api.getBlock(x, y, z) !== 'Air') {
        z++;
    }
    const finalZ = z; // 记录最终使用的z坐标
    api.setBlock(x, y, finalZ, 'Bedrock');
    for (let i = 0; i < data.length; i++) {
        api.setBlock(x + i + 1, y, finalZ, data[i]);
    }
    api.setBlock(x + data.length + 1, y, finalZ, 'Bedrock');
    return finalZ; // 返回实际存储的z轴坐标
}
function readdata(x, y, z) {
    if (api.getBlock(x, y, z) !== 'Bedrock') {
        throw new Error('起始标记缺失');
    }
    let currentX = x + 1;
    const data = [];
    for (let i = 0; i < 500; i++) {
        const block = api.getBlock(currentX, y, z);
        if (block === 'Bedrock') break;
        const charIndex = items.indexOf(block);
        data.push(charIndex !== -1 ? chars[charIndex] : '�'); // 错误字符显示为�
        currentX++;
    }
    return data.join('');
}
// 加入欢迎信息
onPlayerJoin = (playerId) => {
    let user = api.getEntityName(playerId); // 使用 let 声明
    let wenzi = user + '同志，欢迎来到死神永生！';
    api.broadcastMessage([{ str: "", style: { color: "#c3c3c3" } }, { str: wenzi, style: { color: "#71c9ce" } }]);
    wenzi = user + ', Welcome to SSYS!';
    api.broadcastMessage([{ str: "", style: { color: "#c3c3c3" } }, { str: wenzi, style: { color: "#a6e3e9" } }]);
    let playnumber = api.getNumPlayers(); // 使用 let 声明
    api.broadcastMessage('人数为' + playnumber, { color: "#adf7d1" });
}

// 防炸服系统 6/8

const bannedItems = ["Moonstone Explosive", "Moonstone Remote Explosive", "Floor Creator", "RPG", "Fireball",  "Super RPG", "Grenade Launcher", "Bouncy Bomb", "Iceball"/*, "Invisible Solid"*/];
onInventoryUpdated = (playerId) => {
	/*if (api.getEntityName(playerId) === "The_DarkForest" || api.getEntityName(playerId) === "CN_TB_ETO2"){
		return;
	}*/
    for(const item of bannedItems) {
        if(api.getInventoryItemAmount(playerId, item) > 0) {
            api.removeItemName(playerId, item, api.getInventoryItemAmount(playerId, item));
            api.sendMessage(playerId, `在死神永生，你不能携带 ${item}`, { color: "#ff4d4d" });
        }
    }
}
onPlayerChat = (playerId, chatMessage) => {
    if(api.getEntityName(playerId) === "CNrext_LT3" && (chatMessage.startsWith("#") === false)) {
        api.broadcastMessage("[被禁言了]CNrext_LT3: " + chatMessage, { color: "#d7fbe8" });
        return;
    }
    const args = chatMessage.split(/\s+/);
    if (args[0] === '#ssyscmd' && args[1] === 'read' && args.length === 5) {
        const [_, __, xStr, yStr, zStr] = args;
        const x = parseInt(xStr), y = parseInt(yStr), z = parseInt(zStr);
        if (isNaN(x) || isNaN(y) || isNaN(z)) {
            api.sendMessage(playerId, "坐标格式错误：必须为数字", { color: "red" });
            return;
        }
        try {
            const result = readdata(x, y, z);
            api.sendMessage(playerId,
                `数据读取成功 @ ${x},${y},${z}\n` +
                `内容：${result.slice(0, 200)}${result.length > 200 ? "..." : ""}`,
                { color: "#aca8ff" }
            );
        } catch (error) {
            api.sendMessage(playerId, `读取失败：${error.message}`, { color: "red" });
        }
        return;
    }
    if (args[0] === '#ssyscmd' && args[1] === 'save' && args.length >= 5) {
        const [_, __, xStr, yStr, zStr, ...dataParts] = args;
        const dataStr = dataParts.join(' ');
        if (dataStr.length > 300) {
            api.sendMessage(playerId, "数据过长,最大支持300字符", { color: "red" });
            return;
        }
        const x = parseInt(xStr), y = parseInt(yStr), z = parseInt(zStr);
        if (isNaN(x) || isNaN(y) || isNaN(z)) {
            api.sendMessage(playerId, "坐标格式错误：必须为数字", { color: "red" });
            return;
        }
        const convertedData = convert(dataStr);
        if (convertedData.length === 0) {
            api.sendMessage(playerId, "无效数据：字符未匹配物品", { color: "red" });
            return;
        }
        try {
            var FinalZ = savedata(x, -400, z, convertedData);
            api.sendTopRightHelper(
                playerId,
                "floppy-disk", `已存储 ${convertedData.length} 个方块`, { duration: 5, height: 80, width: 280, color: '#7c73e6', textAndIconColor: 'white' }
            );
            if (FinalZ != z) {
                api.sendMessage(playerId, `因为存储空间重复，已将id改为 ${FinalZ}，查看时请使用此id`, { color: "#ffaa64" });
            } else {
                api.sendMessage(playerId, `已将信息存储于 ${FinalZ}，查看时请使用此id`, { color: "#aca8ff" });
            }
        } catch (error) {
            api.sendMessage(playerId, `存储失败：${error.message}`, { color: "red" });
        }
        return;
    }
    if (args[0] === '#ssyscmd' && args[1] === 'intro') {
        api.sendMessage(playerId, "===服务器介绍===", { color: "#aca8ff" });
        api.sendMessage(playerId, ">本服名为死神永生服，是中国创造服\n" + ">腐竹是 The_DarkForest,服务器建立于2024/2/15", { color: "#9de5ff" });
        api.sendMessage(playerId, ">在本服人人平等，全员创造，且都可以自行建造喜欢的建筑\n" + ">本服提供一些特定指令服务，可在聊天输入 #ssyscmd help 查看\n" + ">了解更多请上本服官网 bloxdssys点pages点dev", { color: "#d5fdff" });
    }
    if (args[0] === '#ssyscmd' && args[1] === 'help') {
        api.sendMessage(playerId, "===指令帮助===", { color: "#aca8ff" });
        api.sendMessage(playerId,
            "#ssyscmd intro  ==> 服务器介绍", { color: "#9de5ff" }
        )
        api.sendMessage(playerId,
            "#ssyscmd save 0 -401 [id] [字符串]  ==> 将制定信息存储在指定位置。注意: 0和-401不要改,id是这条信息的唯一编号,储存后可能会提示更新id(可能和别的信息重复),字符串可包含数字字母和符号。\n" +
            "#ssyscmd read 0 -401 [id]  ==> 读取指定编号的信息,同上,id以存储后的提示为准", { color: "#9de5ff" }
        )
        api.sendMessage(playerId,
            "#ssyscmd illegals  ==> 拿违禁品,需清理出15个背包中的空位", { color: "#9de5ff" }
        )
        api.sendMessage(playerId,
            "#admin help  ==> 查看管理员专用指令(管理员才能查看)", { color: "#9df3c4" }
        )
        api.sendMessage(playerId, "指令必须一字不差，尤其是开头的井号和中间的空格不要少", { color: "#fdb87d" });
        api.sendMessage(playerId, "指令版本 3, 5.5更新", { color: "#ac73ff" });
    }
    // ====================== 拿违禁品 ==========================    
    if (args[0] === '#ssyscmd' && args[1] === 'illegals') {
        //giveItem(playerId: PlayerId, itemName: string, itemAmount?: number, attributes?: ItemAttributes)
        api.giveItem(playerId, "Block of Emerald", 1);
        api.giveItem(playerId, "Block of Lapis Lazuli", 1);
        api.giveItem(playerId, "Iron Watermelon", 1);
        api.giveItem(playerId, "Gravel", 1);
        api.giveItem(playerId, "Sponge", 1);
        api.giveItem(playerId, "Block of Quartz", 1);
        api.giveItem(playerId, "Chiseled Block of Quartz", 1);
        api.giveItem(playerId, "Green Stone", 1);
        api.giveItem(playerId, "Green Bricks", 1);
        api.giveItem(playerId, "Hay Bale", 1);
        api.giveItem(playerId, "Beacon", 1);
        api.giveItem(playerId, "Dim Lamp On", 1);
        api.giveItem(playerId, "Dim Lamp Off", 1);
        api.sendMessage(playerId, "你已获得违禁品，目前仅提供铁瓜,绿宝石,青金石,海绵,砂石,绿松石,石英石,信标,干草,灯;别的找服主要也给不了", { color: "#d5fdff" });
        api.sendMessage(playerId, "请谨慎使用违禁品，它们在复制给其他服务器的时候的时候无法被复制", { color: "#ac73ff" }); 
    }
    // |||||||||||||||||||||||||接下来是管理员专用指令||||||||||||||||||||||||||||
    if (args[0] === '#admin') {
        user = api.getEntityName(playerId);
        if (admins.includes(user)) {
            if (args[1] === 'broadcast') {
                const message = args.slice(2).join(' ');
                if (message.length <= 100 && message.length >= 3) {
                    for (const toplayer of api.getPlayerIds()) {
                        api.sendTopRightHelper(
                            toplayer,
                            "commenting",
                            `${message}`,
                            {
                                duration: Math.ceil(3 + message.length * 0.1),
                                color: '#62d2a2', height: 150, width: 500,
                            }
                        );
                    }
                    api.broadcastMessage(user + "广播信息：" + message, { color: "#9df3c4" });
                } else {
                    api.sendMessage(playerId, "消息长度需在3-100字以内", { color: "#ff4d4d" }); 
                }
            }
            else if (args[1] === 'kick') {
                const kickplayer = args[2];
                if (api.getPlayerIds().includes(api.getPlayerId(kickplayer))) {
                    api.kickPlayer(api.getPlayerId(kickplayer), "你被管理员" + user + "踢出服务器");
                } else {
                    api.sendMessage(playerId, "用户不存在", { color: "#ff4d4d" });
                }
            }
            else if (args[1] === 'help') {
                api.sendMessage(playerId, "===管理员指令帮助===", { color: "#62d2a2" });
                api.sendMessage(playerId, "#admin broadcast [消息]  ==> 广播消息", { color: "#9df3c4" });
                api.sendMessage(playerId, "#admin kick [玩家名]  ==> 踢出指定玩家", { color: "#9df3c4" });
                api.sendMessage(playerId, "#admin goto [x] [y] [z]  ==> 传送到指定位置", { color: "#9df3c4" });
            }
            else if (args[1] === 'goto') {
                const [x, y, z] = args.slice(2, 5).map(Number);
                if ([x, y, z].every(v => !isNaN(v))) {
                    api.setPosition(api.getPlayerId(user), x, y, z);
                } else {
                    api.sendMessage(playerId, "坐标格式错误：必须为三个数字", { color: "#ff4d4d" });
                }
            }
            else {
                api.sendMessage(playerId, "未知管理员指令，输入#admin help查看帮助", { color: "#ff4d4d" });
            }
        } else {
            api.sendMessage(playerId, "你没有权限使用这个指令", { color: "#ff4d4d" });
        }
    }
    if (args[0] === '#owner' && args[1] === 'giveadmin') {
        user = api.getEntityName(playerId);
        if (user == owner) {
            const newAdmin = args[2];
            if (api.getPlayerIds().includes(api.getPlayerId(newAdmin))) {
                admins.push(newAdmin);
                api.sendMessage(playerId, "已将" + newAdmin + "添加为管理员", { color: "#9de5ff" });
                api.sendMessage(api.getPlayerId(newAdmin), "你已经是管理员，可以输入#admin help 查看管理员指令", { color: "#d7fbe8" });
            } else {
                api.sendMessage(playerId, "用户不存在", { color: "#ff4d4d" });
            }
        } else {
            api.sendMessage(playerId, "你没有权限使用这个指令", { color: "#ff4d4d" });
        }
    }
    if (args[0] === '#owner' && args[1] === 'removeadmin') {
        user = api.getEntityName(playerId);
        if (user == owner) {
            const Admintoremove = args[2];
            if (admins.includes(Admintoremove)) {
                admins = admins.filter(admin => admin !== Admintoremove);
                api.sendMessage(playerId, "已将" + Admintoremove + "移除管理员", { color: "#9de5ff" });
                api.sendMessage(api.getPlayerId(Admintoremove), "你已被移除管理员", { color: "#d7fbe8" });
            } else {
                api.sendMessage(playerId, "用户不存在或不是管理员", { color: "#ff4d4d" });
            }
        } else {
            api.sendMessage(playerId, "你没有权限使用这个指令", { color: "#ff4d4d" });
        }
    }
    if (chatMessage[0] === '#') {
        return false;
    }
};

onWorldAttemptSpawnMob = (mobType, x, y, z) => {
    if (mobType === "Magma Golem") {
        return "preventSpawn"; // 阻止生成
    }
    return true;
}

onPlayerAttemptSpawnMob = (playerId, mobType, x, y, z) => {
    if (mobType === "Magma Golem") {
        api.sendMessage(playerId, "Magma Golem 已被禁止生成", { color: "red" });
        return "preventSpawn"; // 阻止生成
    }
    return true;
}
let p = 0;

```
